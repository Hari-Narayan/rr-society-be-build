"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const cors_1=__importDefault(require("cors")),path_1=require("path"),express_1=__importDefault(require("express")),console_log_colors_1=require("console-log-colors"),express_fileupload_1=__importDefault(require("express-fileupload")),configs_1=__importDefault(require("./configs")),routes_1=__importDefault(require("./routes")),connection_1=__importDefault(require("./configs/connection")),homePage_1=__importDefault(require("./templates/homePage")),swagger_1=require("./docs/swagger"),responseMiddleware_1=__importDefault(require("./middlewares/responseMiddleware")),startServer=async()=>{const e=(0,express_1.default)();e.use((0,cors_1.default)({origin:"*"})),e.use(express_1.default.json()),e.use(express_1.default.static("public")),e.use(express_1.default.urlencoded({extended:!0})),e.use((0,express_fileupload_1.default)({createParentPath:!0})),e.use(express_1.default.static((0,path_1.join)(__dirname,"../",configs_1.default.uploadPath))),e.use(responseMiddleware_1.default);try{await(0,connection_1.default)(),e.use(configs_1.default.urlPrefix,routes_1.default),e.use(((e,r,s)=>{r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Headers","Content-Type"),r.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE"),s()})),e.use(configs_1.default.docUrlPrefix,swagger_1.swaggerUi.serve,swagger_1.swaggerUi.setup(swagger_1.swaggerSpec,{customJs:"/swagger-auth-token.js"})),e.get("/",homePage_1.default),e.listen(configs_1.default.port,(()=>{console.info(`\nServer running on ${console_log_colors_1.color.blue(configs_1.default.baseUrl)}`),console.info(`API Base URL ${console_log_colors_1.color.blue(configs_1.default.apiBaseUrl)}`),"development"===process.env.NODE_ENV&&console.info(`API DOCS URL ${console_log_colors_1.color.blue(configs_1.default.apiDocUrl)}`)}))}catch(e){console.error("Failed to start server:",e),process.exit(1)}};startServer();