"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.details=exports.massDelete=exports.remove=exports.softDelete=exports.update=exports.create=exports.list=void 0;const guest_1=__importDefault(require("../models/guest")),paginate_1=__importDefault(require("../utils/paginate")),commonHelper_1=__importDefault(require("../helpers/commonHelper")),common_1=require("../lang/en/common"),member_1=require("../models/member"),society_1=require("../models/society"),fileUploadOnCloudHelper_1=__importDefault(require("../helpers/fileUploadOnCloudHelper")),guest_2=require("../lang/en/guest"),list=async(e,t)=>{try{let s=guest_2.GUEST_FOUND;const r=commonHelper_1.default.createSearchFilter(e,["name","contact","purpose","visitTo"],{society:e.user.society.id}),o=commonHelper_1.default.createPageOptions(e),a=await(0,paginate_1.default)(guest_1.default,r,o.page,o.limit,[society_1.populateSocietyOptions,member_1.populateCreatedByOptions],o.sort);0===a.totalDocs&&(s=guest_2.GUEST_NOT_FOUND),t.sendSuccess(200,s,a)}catch(e){t.sendError(500,common_1.SOMETHING_WENT_WRONG,e)}};exports.list=list;const create=async(e,t)=>{try{await fileUploadOnCloudHelper_1.default.uploadSingleFile(e,"image","guests");const s=await new guest_1.default({...e.body,createdBy:e.user.id,society:e.user.society.id}).save();t.sendSuccess(200,guest_2.GUEST_CREATED,s)}catch(e){t.sendError(500,common_1.SOMETHING_WENT_WRONG,e)}};exports.create=create;const update=async(e,t)=>{try{if(!await guest_1.default.findOne({deletedAt:null,_id:e.params.id}))return void t.sendError(400,guest_2.GUEST_NOT_FOUND);await fileUploadOnCloudHelper_1.default.uploadSingleFile(e,"image","guests");const s=await guest_1.default.findOneAndUpdate({_id:e.params.id,deletedAt:null},{$set:e.body},{new:!0});t.sendSuccess(200,guest_2.GUEST_UPDATED,s)}catch(e){t.sendError(500,common_1.SOMETHING_WENT_WRONG,e)}};exports.update=update;const softDelete=async(e,t)=>{try{const s=await guest_1.default.findOneAndUpdate({_id:e.params.id,deletedAt:null},{$set:{deletedAt:new Date}},{new:!0});if(!s)return void t.sendError(400,guest_2.GUEST_NOT_FOUND);t.sendSuccess(200,guest_2.GUEST_DELETED,s)}catch(e){t.sendError(500,common_1.SOMETHING_WENT_WRONG,e)}};exports.softDelete=softDelete;const remove=async(e,t)=>{try{if(!await guest_1.default.findOneAndDelete({_id:e.params.id}))return void t.sendError(400,guest_2.GUEST_NOT_FOUND);t.sendSuccess(200,guest_2.GUEST_DELETED)}catch(e){t.sendError(500,common_1.SOMETHING_WENT_WRONG,e)}};exports.remove=remove;const massDelete=async(e,t)=>{try{const s=e.body.ids||[];if(0===(await guest_1.default.deleteMany({_id:{$in:s}})).deletedCount)return void t.sendError(400,guest_2.GUEST_NOT_FOUND);t.sendSuccess(200,guest_2.GUEST_DELETED)}catch(e){t.sendError(500,common_1.SOMETHING_WENT_WRONG,e)}};exports.massDelete=massDelete;const details=async(e,t)=>{try{let s=await guest_1.default.findOne({deletedAt:null,_id:e.params.id,society:e.user.society.id}).populate([member_1.populateCreatedByOptions,society_1.populateSocietyOptions]);if(!s)return void t.sendError(400,guest_2.GUEST_NOT_FOUND);t.sendSuccess(200,guest_2.GUEST_FOUND,s)}catch(e){t.sendError(500,common_1.SOMETHING_WENT_WRONG,e)}};exports.details=details;