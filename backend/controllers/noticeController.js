"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.details=exports.massDelete=exports.remove=exports.softDelete=exports.update=exports.create=exports.list=void 0;const notice_1=__importDefault(require("../models/notice")),paginate_1=__importDefault(require("../utils/paginate")),commonHelper_1=__importDefault(require("../helpers/commonHelper")),common_1=require("../lang/en/common"),member_1=require("../models/member"),society_1=require("../models/society"),notice_2=require("../lang/en/notice"),list=async(e,t)=>{try{let o=notice_2.NOTICE_FOUND;const r=commonHelper_1.default.createSearchFilter(e,["title","description"],{society:e.user.society.id}),s=commonHelper_1.default.createPageOptions(e),n=await(0,paginate_1.default)(notice_1.default,r,s.page,s.limit,[society_1.populateSocietyOptions,member_1.populateCreatedByOptions],s.sort);0===n.totalDocs&&(o=notice_2.NOTICE_NOT_FOUND),t.sendSuccess(200,o,n)}catch(e){t.sendError(500,common_1.SOMETHING_WENT_WRONG,e)}};exports.list=list;const create=async(e,t)=>{try{const o=await new notice_1.default({...e.body,createdBy:e.user.id,society:e.user.society.id}).save();t.sendSuccess(200,notice_2.NOTICE_CREATED,o)}catch(e){t.sendError(500,common_1.SOMETHING_WENT_WRONG,e)}};exports.create=create;const update=async(e,t)=>{try{if(!await notice_1.default.findOne({deletedAt:null,_id:e.params.id}))return void t.sendError(400,notice_2.NOTICE_NOT_FOUND);const o=await notice_1.default.findOneAndUpdate({_id:e.params.id,deletedAt:null},{$set:e.body},{new:!0});t.sendSuccess(200,notice_2.NOTICE_UPDATED,o)}catch(e){t.sendError(500,common_1.SOMETHING_WENT_WRONG,e)}};exports.update=update;const softDelete=async(e,t)=>{try{let o=await notice_1.default.findOneAndUpdate({_id:e.params.id,deletedAt:null},{$set:{deletedAt:new Date}},{new:!0});if(!o)return void t.sendError(400,notice_2.NOTICE_NOT_FOUND);t.sendSuccess(200,notice_2.NOTICE_DELETED,o)}catch(e){t.sendError(500,common_1.SOMETHING_WENT_WRONG,e)}};exports.softDelete=softDelete;const remove=async(e,t)=>{try{if(!await notice_1.default.findOneAndDelete({_id:e.params.id}))return void t.sendError(400,notice_2.NOTICE_NOT_FOUND);t.sendSuccess(200,notice_2.NOTICE_DELETED)}catch(e){t.sendError(500,common_1.SOMETHING_WENT_WRONG,e)}};exports.remove=remove;const massDelete=async(e,t)=>{try{const o=e.body.ids||[];if(0===(await notice_1.default.deleteMany({_id:{$in:o}})).deletedCount)return void t.sendError(400,notice_2.NOTICE_NOT_FOUND);t.sendSuccess(200,notice_2.NOTICE_DELETED)}catch(e){t.sendError(500,common_1.SOMETHING_WENT_WRONG,e)}};exports.massDelete=massDelete;const details=async(e,t)=>{try{let o=await notice_1.default.findOne({deletedAt:null,_id:e.params.id,society:e.user.society.id}).populate([member_1.populateCreatedByOptions,society_1.populateSocietyOptions]);if(!o)return void t.sendError(400,notice_2.NOTICE_NOT_FOUND);t.sendSuccess(200,notice_2.NOTICE_FOUND,o)}catch(e){t.sendError(500,common_1.SOMETHING_WENT_WRONG,e)}};exports.details=details;