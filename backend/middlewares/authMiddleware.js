"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkPermission=void 0;const member_1=require("../lang/en/member"),responseHelper_1=__importDefault(require("../helpers/responseHelper")),authHelper_1=require("../helpers/authHelper"),auth_1=require("../lang/en/auth"),auth=async(e,r,s)=>{const t=(e.headers.authorization||"").replace("Bearer ","");try{if(!t)return responseHelper_1.default.error({res:r,code:401,message:auth_1.TOKEN_NOT_PROVIDED});const o=await(0,authHelper_1.verifyTokenAndGetUser)(t);e.user=o,s()}catch(e){return console.error(e),responseHelper_1.default.error({res:r,code:401,error:e,message:e.message===member_1.MEMBER_NOT_FOUND?member_1.MEMBER_NOT_FOUND:auth_1.UNAUTHORIZED})}},checkPermission=e=>(r,s,t)=>{const{user:o}=r;return o?o.permissions.includes(e)?void t():responseHelper_1.default.error({res:s,code:403,message:auth_1.FORBIDDEN}):responseHelper_1.default.error({res:s,code:401,message:member_1.MEMBER_NOT_FOUND})};exports.checkPermission=checkPermission,exports.default=auth;